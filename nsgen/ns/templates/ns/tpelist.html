<!DOCTYPE html>
<meta charset="utf-8"/>
<head>
<style>

</style>
</head>
<body>
<!-- it's empty bcs stuff gets generated by d3 -->
</body>
<script src="d3.v4.min.js"></script>
<script src="jquery.min.js"></script>

<script>
class ViewTypeDef {
  constructor(text) {
    // TODO: filter here OR filter in the TpeModel try_create functions
    this.text = text;
    this.id = text;
  }
}

class TpeModel {
  constructor() {
    this.types = [];
    this.functions = [];
    this.classes = [];
    this.methods = [];
  }
  get_types() { return this.types; }
  get_functions() { return this.functions; }
  get_classes() { return this.classes; }
  get_methods() { return this.methods; }
  _try_add_to_vtd_lst(lst, word) { if (lst.map(d=>d.text).indexOf(word)==-1) lst.push(new ViewTypeDef(word)); }
  try_create_type(word) { this. _try_add_to_vtd_lst(this.types, word); }
  try_create_function(word) { this. _try_add_to_vtd_lst(this.functions, word); }
  try_create_class(word) { this. _try_add_to_vtd_lst(this.classes, word); }
  try_create_method(word) { this. _try_add_to_vtd_lst(this.methods, word); }
  _try_del_from_vtd_lst(lst, vtd) {
    if (lst.indexOf(vtd) == -1) return;

  }
}

class TypeTreeUi {
  constructor(root, tpe_model) {
    this.tpe_model = tpe_model;

    // define base groups for each kind of object
    this.types = root.append("g");
    this.functions = root.append("g");
    this.classes = root.append("g");
    this.methods = root.append("g");

    // create static elements
    this.types.append("div").html("* type ").append("input").attr("id", "tbxTypes");
    this.functions.append("div").html("* function ").append("input").attr("id", "tbxFunctions");
    this.classes.append("div").html("* class ").append("input").attr("id", "tbxClasses");
    this.methods.append("div").html("* method ").append("input").attr("id", "tbxMethods");

    // let dynamic elements get their own gruop
    this.types = this.types.append("g");
    this.functions = this.functions.append("g");
    this.classes = this.classes.append("g");
    this.methods = this.methods.append("g");

    // put some events into the text boxes using jquery
    this._box_change_setup( "#tbxTypes", this.types,
      this.tpe_model.try_create_type.bind(this.tpe_model),
      this.tpe_model.get_types.bind(this.tpe_model));
    this._box_change_setup( "#tbxFunctions", this.functions,
      this.tpe_model.try_create_function.bind(this.tpe_model),
      this.tpe_model.get_functions.bind(this.tpe_model));
    this._box_change_setup( "#tbxClasses", this.classes,
      this.tpe_model.try_create_class.bind(this.tpe_model),
      this.tpe_model.get_classes.bind(this.tpe_model));
    this._box_change_setup( "#tbxMethods", this.methods,
      this.tpe_model.try_create_method.bind(this.tpe_model),
      this.tpe_model.get_methods.bind(this.tpe_model));
  }
  _box_change_setup(box_id, group, create_fct, get_fct) {
    $(box_id).change(() => {
      let val = $(box_id).val();
      create_fct(val);
      this._sync(group, get_fct());
    });
  }
  _sync(group, vtd_lst) {
    group
      .selectAll("div")
      .remove();
    group
      .selectAll("div")
      .data(vtd_lst)
      .enter()
      .append("div")
      .html(function(d) { return d.text; })
      .attr("id", function(d) { return d.id });
  }
}

$(document).ready(() => {
  let ttui = new TypeTreeUi(d3.select("body"), new TpeModel());
});
</script>


</html>
